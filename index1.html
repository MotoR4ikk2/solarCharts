<div>
    <canvas id="myChart"></canvas>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
<script>

let chartData2022 = [
    {
        "type": "column",
        "name": "Выработка (без счетчика)",
        "stacking": "normal",
        "data": [
            [
                1643673600000,
                508.26
            ],
            [
                1646092800000,
                1326.07
            ],
            [
                1648771200000,
                1432.12
            ],
            [
                1651363200000,
                841.44
            ]
        ],
        "index": 3,
        "color": "#F7C002",
        "fillOpacity": 0,
        "yAxis": "kWh",
        "id": "FromGenToSomewhere",
        "threshold": 0,
        "tooltip": {
            "valueSuffix": "kWh",
            "valueDecimals": 2
        },
        "dashStyle": "solid"
    },
    {
        "type": "column",
        "name": "Энергия в сеть",
        "stacking": "normal",
        "data": [
            [
                1651363200000,
                19.67
            ],
            [
                1654041600000,
                55.63
            ],
            [
                1656633600000,
                52.62
            ],
            [
                1659312000000,
                28.89
            ],
            [
                1661990400000,
                11.35
            ],
            [
                1664582400000,
                17.11
            ],
            [
                1667260800000,
                0.22
            ],
            [
                1669852800000,
                0.12
            ]
        ],
        "index": 1,
        "color": "#999999",
        "fillOpacity": 0,
        "yAxis": "kWh",
        "id": "FromGenToGrid",
        "threshold": 0,
        "tooltip": {
            "valueSuffix": "kWh",
            "valueDecimals": 2
        },
        "dashStyle": "solid"
    },
    {
        "type": "column",
        "name": "Непосредственно потреблено",
        "stacking": "normal",
        "data": [
            [
                1651363200000,
                1365.54
            ],
            [
                1654041600000,
                1902.08
            ],
            [
                1656633600000,
                1997.85
            ],
            [
                1659312000000,
                1519.01
            ],
            [
                1661990400000,
                1002.38
            ],
            [
                1664582400000,
                897.61
            ],
            [
                1667260800000,
                216.49
            ],
            [
                1669852800000,
                111.56
            ]
        ],
        "index": 6,
        "color": "#FAD967",
        "fillOpacity": 0,
        "yAxis": "kWh",
        "id": "FromGenToConsumer",
        "threshold": 0,
        "tooltip": {
            "valueSuffix": "kWh",
            "valueDecimals": 2
        },
        "dashStyle": "solid"
    }
];

let chartData2023 = [
    {
        "type": "column",
        "name": "Энергия в сеть",
        "stacking": "normal",
        "data": [
            [
                1672531200000,
                0.05
            ],
            [
                1675209600000,
                0.71
            ],
            [
                1677628800000,
                5.55
            ],
            [
                1680307200000,
                16.06
            ],
            [
                1682899200000,
                46.83
            ],
            [
                1685577600000,
                43.9
            ],
            [
                1688169600000,
                37.09
            ],
            [
                1690848000000,
                29.79
            ],
            [
                1693526400000,
                18.11
            ],
            [
                1696118400000,
                2.52
            ],
            [
                1698796800000,
                0.31
            ],
            [
                1701388800000,
                0.03
            ]
        ],
        "index": 1,
        "color": "#999999",
        "fillOpacity": 0,
        "yAxis": "kWh",
        "id": "FromGenToGrid",
        "threshold": 0,
        "tooltip": {
            "valueSuffix": "kWh",
            "valueDecimals": 2
        },
        "dashStyle": "solid"
    },
    {
        "type": "column",
        "name": "Непосредственно потреблено",
        "stacking": "normal",
        "data": [
            [
                1672531200000,
                114.62
            ],
            [
                1675209600000,
                546.88
            ],
            [
                1677628800000,
                1030.34
            ],
            [
                1680307200000,
                1014.5
            ],
            [
                1682899200000,
                2161.9
            ],
            [
                1685577600000,
                2017.15
            ],
            [
                1688169600000,
                2088.56
            ],
            [
                1690848000000,
                2074.1
            ],
            [
                1693526400000,
                1485.34
            ],
            [
                1696118400000,
                876.45
            ],
            [
                1698796800000,
                307.18
            ],
            [
                1701388800000,
                201.49
            ]
        ],
        "index": 6,
        "color": "#FAD967",
        "fillOpacity": 0,
        "yAxis": "kWh",
        "id": "FromGenToConsumer",
        "threshold": 0,
        "tooltip": {
            "valueSuffix": "kWh",
            "valueDecimals": 2
        },
        "dashStyle": "solid"
    }
];

function processChartData(chartData) {
    const energyToGridData = [];
    const consumerData = [];
    const monthLabel = [];
    const yearLabel = [];

    chartData.forEach(chartItem => {
        chartItem.data.forEach(dataPoint => {
            const value = dataPoint[1];

            if (chartItem.id === 'FromGenToGrid') {
                processEnergyToGridData(dataPoint, energyToGridData, monthLabel, yearLabel);
            } else if (chartItem.id === 'FromGenToConsumer') {
                processConsumerData(dataPoint, consumerData);
            }
        });
    });

    const generateEnergy = energyToGridData.map((value, index) => {
        return value + consumerData[index];
    });

    return {
        energyToGridData,
        consumerData,
        monthLabel,
        yearLabel,
        generateEnergy
    };
}

function processEnergyToGridData(dataPoint, energyToGridData, monthLabel, yearLabel) {
    const time = new Date(dataPoint[0]);
    const monthName = time.toLocaleDateString('uk-UA', { month: 'long' });
    const yearName = time.toLocaleDateString('uk-UA', { year: 'numeric' });
    yearLabel.push(yearName);
    monthLabel.push(monthName);
    energyToGridData.push(dataPoint[1]);
}

function processConsumerData(dataPoint, consumerData) {
    consumerData.push(dataPoint[1]);
}

// Використання функції
const chartDataResult2022 = processChartData(chartData2022);
const chartDataResult2023 = processChartData(chartData2023);
    const ctx = document.getElementById('myChart');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: chartDataResult2023.monthLabel,
        datasets: [{
          label: '# кВт 2022',
          data: chartDataResult2022.generateEnergy,
          borderWidth: 1
        },
        {
          label: '# кВт 2023',
          data: chartDataResult2023.generateEnergy,
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  </script>
  